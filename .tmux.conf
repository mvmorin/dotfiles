###############################################################################
# unbind all default keybinds
################################################################################
unbind C-o     # rotate-window
unbind C-z     # suspend-client
unbind Space   # next-layout
unbind !       # break-pane
unbind '"'     # split-window
unbind '#'     # list-buffers
unbind '$'     # command-prompt -I "#S" "rename-session -- '%%'"
unbind '%'     # split-window -h
unbind '&'     # confirm-before -p "kill-window #W? (y/n)" kill-window
unbind "'"     # command-prompt -p index "select-window -t ':%%'"
unbind (       # switch-client -p
unbind )       # switch-client -n
unbind ,       # command-prompt -I "#W" "rename-window -- '%%'"
unbind -       # delete-buffer
unbind .       # command-prompt "move-window -t '%%'"
unbind 0       # select-window -t :=0
unbind 1       # select-window -t :=1
unbind 2       # select-window -t :=2
unbind 3       # select-window -t :=3
unbind 4       # select-window -t :=4
unbind 5       # select-window -t :=5
unbind 6       # select-window -t :=6
unbind 7       # select-window -t :=7
unbind 8       # select-window -t :=8
unbind 9       # select-window -t :=9
unbind :       # command-prompt
unbind \;      # last-pane
unbind =       # choose-buffer -Z
unbind ?       # list-keys
unbind D       # choose-client -Z
unbind E       # select-layout -E
unbind L       # switch-client -l
unbind M       # select-pane -M
unbind [       # copy-mode
unbind ]       # paste-buffer
unbind c       # new-window
unbind d       # detach-client
unbind f       # command-prompt "find-window -- '%%'"
unbind i       # display-message
unbind l       # last-window
unbind m       # select-pane -m
unbind n       # next-window
unbind o       # select-pane -t :.+
unbind p       # previous-window
unbind q       # display-panes
unbind r       # refresh-client
unbind s       # choose-tree -Zs
unbind t       # clock-mode
unbind w       # choose-tree -Zw
unbind x       # confirm-before -p "kill-pane #P? (y/n)" kill-pane
unbind z       # resize-pane -Z
unbind {       # swap-pane -U
unbind }       # swap-pane -D
unbind '~'     # show-messages
unbind PPage   # copy-mode -u
unbind Up      # select-pane -U
unbind Down    # select-pane -D
unbind Left    # select-pane -L
unbind Right   # select-pane -R
unbind M-1     # select-layout even-horizontal
unbind M-2     # select-layout even-vertical
unbind M-3     # select-layout main-horizontal
unbind M-4     # select-layout main-vertical
unbind M-5     # select-layout tiled
unbind M-n     # next-window -a
unbind M-o     # rotate-window -D
unbind M-p     # previous-window -a
unbind M-Up    # resize-pane -U 5
unbind M-Down  # resize-pane -D 5
unbind M-Left  # resize-pane -L 5
unbind M-Right # resize-pane -R 5
unbind C-Up    # resize-pane -U
unbind C-Down  # resize-pane -D
unbind C-Left  # resize-pane -L
unbind C-Right # resize-pane -R


###############################################################################
# basics
################################################################################
# remap prefix from 'C-b' to 'C-Space'
unbind C-b
set -g prefix C-Space
#bind C-Space send-prefix

set -g history-limit 10000
set -w -g wrap-search off
set -g detach-on-destroy off
set -g renumber-windows on

# Set a default layout
set -g other-pane-width 85
set -s command-alias[1] layout='select-layout main-vertical'

################################################################################
# input behaviour and modes
################################################################################
set -g escape-time 0
set -g mouse on

set -g status-keys vi
set -g mode-keys vi
unbind -a -T copy-mode

bind -T copy-mode-vi Escape send -X cancel
bind -T copy-mode-vi WheelUpPane send -t'{mouse}' -N 3 -X scroll-up
bind -T copy-mode-vi WheelDownPane send -t'{mouse}' -N 3 -X scroll-down

# don't copy when releasing selection, only stop selection
bind -T copy-mode-vi MouseDragEnd1Pane send -t'{mouse}' -X stop-selection

# emulate scrolling by sending up and down keys in less and similar
bind-key -T root WheelUpPane \
	if-shell -Ft= '#{?mouse_any_flag,1,#{pane_in_mode}}' \
		'send -Mt=' \
		'if-shell -t= "#{?alternate_on,true,false}" "send -t= -N 3 Up" "copy-mode -et="'

bind-key -T root WheelDownPane \
	if-shell -Ft = '#{?pane_in_mode,1,#{mouse_any_flag}}' \
		'send -Mt=' \
		'if-shell -t= "#{?alternate_on,true,false}" "send -t= -N 3 Down" "send -Mt="'


################################################################################
# prefix commands
################################################################################
# Basic commands
bind c copy-mode
bind v paste-buffer
bind ? list-keys
bind C-z suspend-client
bind : command-prompt
bind z source-file ~/.tmux.conf \; display-message "~/.tmux.conf reloaded"

# window manegement
bind r command-prompt -I "#W" "rename-window -- '%%'"
bind f command-prompt "find-window -- '%%'"
bind w choose-tree -Zw
# marks? (select-pane -m/-M)

# session manegment
bind d detach-client
bind s choose-tree -Zs
bind R command-prompt -I "#S" "rename-session -- '%%'"

bind g command-prompt -p "New session:" \
	"if-shell -F '%1' \
		'new-session -A -s %1' \
		'new-session'"
bind t command-prompt -p "Move window to session:" \
	"if-shell 'tmux has-session -t %1' \
		'move-window -a -t %1:#\$ \; attach-session -t %1:#\$' \
		'new-session -d -s %1 \; move-window -k -t %1:^ \; attach-session -t %1'"



################################################################################
# non-prefix shortcuts - hopefully Alt-bindings won't conflict too much
################################################################################
# window manegement
bind -n M-o new-window
bind -n M-i next-window
bind -n M-u previous-window

# new/kill pane
bind -n M-y split-window -b \; layout
bind -n M-Q select-pane -t :.+ \; kill-pane -t :.- \; layout

# focus panes
bind -n M-j select-pane -t :.+
bind -n M-k select-pane -t :.-

# move panes
bind -n M-h swap-pane -U
bind -n M-l swap-pane -D

# toggle main/prev
bind -n M-n if-shell -F '#{==:#P,0}' 'select-pane -t !' 'select-pane -t 0'
bind -n M-N if-shell -F '#{==:#P,0}' 'swap-pane -d -s !' 'swap-pane -s 0'

# move pane to new/next/prev window
bind -n M-O break-pane
bind -n M-I move-pane -b -s :. -t :+.0
bind -n M-U move-pane -b -s :. -t :-.0

# maximize and reformat layout
bind -n M-m resize-pane -Z
bind -n M-. layout

# # resize - rarely used, see if I manage without
# bind -n M-K resize-pane -U
# bind -n M-J resize-pane -D
# bind -n M-H resize-pane -L
# bind -n M-L resize-pane -R


################################################################################
# Looks
################################################################################
# status bar layout
set -g status-position top

set -g status-left-length 40
set -g status-left '[#S] #[fg=colour5]:: '
set -g window-status-separator ' '
set -g window-status-format '[#I:#W#F]'
set -g window-status-current-format '[#I:#W#F]'
set -g status-right "#[fg=colour5]:: #[fg=colour2][$USER@#h]"

# status bar colors
set -g status-left-style bg=colour0,fg=colour2
set -g status-style bg=colour0,fg=colour5
set -g status-right-style bg=colour0,fg=colour2

set -g window-status-current-style bg=colour6,fg=colour0
set -g window-status-style bg=colour0,fg=colour6
set -g window-status-last-style bg=colour0,fg=colour6
set -g window-status-bell-style bg=colour1,fg=colour0
set -g window-status-activity-style bg=colour1,fg=colour0

# mode colors
set -g message-command-style bg=colour0,fg=colour3
set -g message-style bg=colour0,fg=colour3
set -g mode-style bg=colour3,fg=colour0

# pane colors
set -g pane-border-status top
set -g pane-border-format '[#P:#{pane_current_command}]'
set -g pane-border-style fg=colour8,bg=colour0
set -g pane-active-border-style fg=colour6,bg=colour0
